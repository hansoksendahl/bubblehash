var bubblehash=function bubblehash(){var out={};function logger(messages,prefix){prefix=prefix?prefix+": ":"";function log(code,type){return function(err){type=type||"log";err=err||"";var message=prefix+messages[code];if(err){message+="\n\n"+err}console[type](message)}}log.warning=function(code){return log(code,"warning")};log.error=function(code){return log(code,"error")};return log}out.logger=logger;var xhr=function xhr(){var logMessages={},log;logMessages[0]="We get signal!";logMessages[1]="Opening connection...";logMessages[8192]="Connction attempt timed out.";logMessages[8193]="Lost signal.";log=logger(logMessages,"Signal");return function init(url){var request=new XMLHttpRequest,out={},headers={},data;request.ontimeout=log(8192);request.onerror=log(8193);function send(type,callback){var queryString="",queryIndex,key;if(data){queryString="json="+JSON.stringify(data);if(type==="get"){queryIndex=url.indexOf("?");if(queryIndex!==-1){url.replace("?","?"+queryString+"&")}}}request.open(type,url);for(key in headers){request.setRequestHeader(key,headers[key])}request.onload=callback;if(type==="post"){request.setRequestHeader("Content-type","application/x-www-form-urlencoded");request.send(queryString)}else{request.send()}}out.headers=function headers(key,value){if(arguments.length<2){if(typeof key==="string"){return headers[key]}for(value in key){headers[value]=key[value]}}else{headers[key]=value}};out.data=function dataSetter(obj){if(arguments.length===0){return data}data=obj;return out};out.get=function get(callback){send("get",callback);return out};out.post=function(callback){send("post",callback);return out};return out}}();out.xhr=xhr;var rtc=function rtc(){var peerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,iceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,sessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,logMessages={};var log=logger(logMessages,"RTC");return function init(server,options){var connection=new peerConnection(server,options),out={},dataChannel;connection.ondatachannel=log(0);connection.createDataChannel("BH",{reliable:false});connection.onicecandidate=addIceCandidate;function dataChannel(event){dataChannel=event.channel;dataChannel.onmessage=message}function message(event){var signal=JSON.parse(event.data);console.log(signal)}function addIceCandidate(event){if(event.candidate){connection.addIceCandidate(event.candidate)}}function createOffer(success){success=success||log(1);connection.createOffer(success,log.error(8193),{mandatory:{OfferToReceiveVideo:false,OfferToReceiveAudio:false}})}function createAnswer(success){success=success||log(2);connection.createAnswer(success,log.error(8194),{mandatory:{OfferToReceiveVideo:false,OfferToReceiveAudio:false}})}function setLocalDescription(description,success){success=success||log(3);connection.setLocalDescription(description,function(){success(description)},log.error(8192))}function setRemoteDescription(description,success){description=typeof description==="string"?JSON.parse(description):description;success=success||log(4);var dict=new sessionDescription(description);connection.setRemoteDescription(dict,function(){success(description)},log.error(8195))}out.call=function(callback){createOffer(function(description){setLocalDescription(description,callback)})};out.answer=function(description,callback){setRemoteDescription(description);createAnswer(function(){setLocalDescription(callback)})};return out}}();out.rtc=rtc;return out}();