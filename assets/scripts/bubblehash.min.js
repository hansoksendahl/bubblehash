var BubbleHash=function(){var Chord=function(){var hash;hash=murmurHash3.x64.hash128;function inRange(key,low,high){return lessThan(low,high)&&lessThan(low,key)&&lessThan(key,high)||lessThan(high,low)&&(lessThan(low,key)||lessThan(key,high))||equalTo(low,high)&&!equalTo(key,low)}function inHalfOpenRange(key,low,high){return lessThan(low,high)&&lessThan(low,key)&&lessThanOrEqual(key,high)||lessThan(high,low)&&(lessThan(low,key)||lessThanOrEqual(key,high))||equalTo(low,high)}function lessThan(low,high){if(low.length!==high.length){return low.length<high.length}for(var i=0;i<low.length;++i){if(low[i]<high[i]){return true}else if(low[i]>high[i]){return false}}return false}function lessThanOrEqual(low,high){if(low.length!==high.length){return low.length<=high.length}for(var i=0;i<low.length;++i){if(low[i]<high[i]){return true}else if(low[i]>high[i]){return false}}return true}function equalTo(a,b){if(a.length!==b.length){return false}for(var i=0;i<a.length;++i){if(a[i]!==b[i]){return false}}return true}function addExp(key,exponent){var result=key.concat();var index=key.length-Math.floor(exponent/32)-1;result[index]+=1<<exponent%32;var carry=0;while(index>=0){result[index]+=carry;carry=0;if(result[index]>4294967295){result[index]-=4294967296;carry=1}--index}return result}function next_key(key){return addExp(key,0)}function Chord(version){this.version=version;this.successor=null;this.predecessor=null}Chord.prototype.findSuccessor=function findSuccessor(x){};Chord.prototype.closestPrecedingNode=function closestPrecedingNode(x){};Chord.prototype.buildFingers=function buildFingers(s){};Chord.prototype.fixFingers=function fixFingerl(){};Chord.prototype.checkPredecessor=function checkPredecessor(){};Chord.prototype.fixSuccssorList=function fixSuccssorList(){};Chord.prototype.fixSuccssor=function fixSuccssor(){};["join","stabilization","notify"].forEach(function(name){Chord.prototype[name]=function(){this[name+this.version].apply(this,arguments)}});Chord.prototype.join1=function join(n_prime){};Chord.prototype.stabilization1=function stabilization(){};Chord.prototype.notify1=function(n){};Chord.prototype.join2=function join2(){};Chord.prototype.stabilization2=function stabilization2(){};Chord.prototype.notify2=function notify2(){};Chord.prototype.notifyJoin=function notifyJoin(Pred_o,Pred_n){};Chord.prototype.fixFinger=function fixFinger(i,target){};Chord.prototype.notifyLeave=function notifyLeave(Succ_o,Succ_n){};return Chord}();function BubbleHash(options){var self=this;function peer(options){var pc=new Peer(options);pc.on("connection",function(dataConnection){self.connections.push(dataConnection);dataConnection.on("close",function(){self.connections=self.connections.filter(function(rc){return rc.peer!==dataConnection.peer})})});return pc}this.connections=[];this.peer=peer(options)}return BubbleHash}();(function(exports){var ui,bubblehash,log,manifest,socketNumber=50;bubblehash=function(){var options={};options.key="mbv2swgd5tztcsor";options.config={iceServers:[{url:"stun:stun4.l.google.com:19302"},{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun01.sipphone.com"},{url:"stun:stun.ekiga.net"},{url:"stun:stun.fwdnet.net"},{url:"stun:stun.ideasip.com"},{url:"stun:stun.iptel.org"},{url:"stun:stun.rixtelecom.se"},{url:"stun:stun.schlund.de"},{url:"stun:stunserver.org"},{url:"stun:stun.softjoys.com"},{url:"stun:stun.voiparound.com"},{url:"stun:stun.voipbuster.com"},{url:"stun:stun.voipstunt.com"},{url:"stun:stun.voxgratia.org"},{url:"stun:stun.xten.com"},{url:"turn:numb.viagenie.ca:3478",username:"hansoksendahl@gmail.com",credential:"num0mg!!"}]};options.debug=3;return new BubbleHash(localStorage.socketId,options)}();manifest=function(){var domain="http://mudb.org",length=25,key="ZZZZ",out={},xhr;var XHR=function(){function XHR(){this.request=new XMLHttpRequest;this.__header={};this.__data={}}XHR.prototype.header=function headers(key,value){if(arguments.length<2){if(typeof key==="string"){return this.__header[key]}for(value in key){this.__header[value]=key[value]}}else{this.__header[key]=value;return this}};XHR.prototype.data=function dataSetter(obj){if(arguments.length===0){return this.__data}this.__data=obj;return this};XHR.prototype.get=function get(url,callback){this.send("get",url,callback);return out};XHR.prototype.post=function(url,callback){this.send("post",url,callback);return out};XHR.prototype.send=function send(type,url,callback){var queryString="",queryIndex,key;if(this.__data){queryString="json="+JSON.stringify(this.__data);if(type==="get"){queryIndex=url.indexOf("?");if(queryIndex!==-1){url.replace("?","?"+queryString+"&")}}}this.request.open(type,url);for(key in this.__header){this.request.setRequestHeader(key,this.__header[key])}this.request.onload=callback;if(type==="post"){this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.request.send(queryString)}else{this.request.send()}};return XHR}();xhr=new XHR;out.get=function(callback){xhr.get(domain+"/get/"+key,callback)};out.set=function(manifest,callback){manifest.__id=key;xhr.data(manifest).post(domain+"/set/json",callback)};out.request=xhr.request;return out}();var ui=function(){var elements={};$('[id|="ui"]').each(function(){var key=this.id.match(/^ui-(.+)$/)[1];elements[key]=$(this)});return elements}();log=function(){var Logger=function(){function Logger(types,messages,prefix){this.prefix=prefix?prefix+": ":"";this.messages=messages;var self=this,i;function typeCallback(type){return function(code,callback){return this.onmessage(type,this.getMessage(code),callback)}}for(var i=0;i<types.length;i+=1){this[types[i]]=typeCallback(types[i])}}Logger.prototype.getMessage=function(code){return this.prefix+this.messages[code]};return Logger}();var logger,messages={},i=0;messages["info:welcome"]="BubbleHash by OX-Design.";messages["success:connected"]="Connected to websocket.";messages["info:searching"]="Searching for peers.";messages["error:general"]="An error occured.\n\n";messages["success:recvConnection"]="Remote dataconnection received!";messages["danger:xhrError"]="Could not request manifest file.";messages["danger:xhrTimeout"]="Timed out while requesting manifest file.";messages["success:manifestGet"]="Got peer manifest.";messages["info:manifestUpdate"]="Updated peer manifest.";messages["success:createConnection"]="Connected to BubbleHash!";logger=new Logger(["success","info","warning","danger"],messages);logger.onmessage=function(type,message,callback){message=message.replace(/\n/g,"<br>");function show(e){var alertBox=ui[type].clone(),displayMessage=message;if(Object.prototype.toString.call(e).indexOf("Error")!==-1){displayMessage+=e.message}alertBox.attr("id",type+i);alertBox.find(".message").html(displayMessage);ui.alertContainer.prepend(alertBox);alertBox.show().alert();window.setTimeout(function(){alertBox.fadeTo(500,0).slideUp(500,function(){alertBox.remove()})},3e3);if(callback){callback.apply(this,arguments)}i+=1}return show};return logger}();var peerOpen=function(id){localStorage.socketId=id;manifest.get(log.success("success:manifestGet",function(){var data=this.responseText!==""?JSON.parse(this.responseText):{},list;data.manifest=data.manifest||[];data.manifest=data.manifest.filter(function(e){return e!==id});manifest.set({manifest:[id].concat(data.manifest)},log.info("info:manifestUpdate"));function initialConnection(){var dataConnection=bubblehash.peer.connect(data.manifest[0],{metadata:bubblehash.metadata});dataConnection.on("open",log.success("success:createConnection",peerConnection));bubblehash.peer.once("error",function(){data.manifest=data.manifest.slice(1);manifest.set({manifest:[id].concat(data.manifest)},log.info("info:manifestUpdate"));if(bubblehash.connections.length===0&&data.manifest.length>0){initialConnection()}});dataConnection.once("close",connectClose)}if(data.manifest.length>0){initialConnection()}}))};function peerConnection(dataConnection){ui.statusOff.hide();ui.statusOn.show();ui.search.removeAttr("disabled");ui.searchQuery.removeAttr("disabled");if(bubblehash.connections.length===1){ui.searchQuery.tooltip("show")}dataConnection.once("close",connectClose)}function connectClose(){if(bubblehash.connections.length===0){ui.statusOn.hide();ui.statusOff.show();ui.search.attr("disabled","disabled");ui.searchQuery.attr("disabled","disabled").tooltip("hide");peerOpen(bubblehash.peer.id)}}(function(){$('[rel="tooltip"]').tooltip()})();bubblehash.peer.on("open",log.success("success:connected",peerOpen));bubblehash.peer.on("connection",log.success("success:recvConnection",peerConnection));bubblehash.peer.on("error",function(err){switch(err.type){case"browser-incompatible":log.danger("danger:"+err.type)();break;case"invalid-key":log.danger("danger:"+err.type)();break;case"invalid-id":log.danger("danger:"+err.type)();break;case"unavailable-id":log.danger("danger:"+err.type)();break;case"ssl-unavailable":log.danger("danger:"+err.type)();break;case"server-disconnected":log.danger("danger:"+err.type)();break;case"server-error":log.danger("danger:"+err.type)();break;case"socket-error":log.danger("danger:"+err.type)();break;case"socket-closed":log.danger("danger:"+err.type)();break}});ui.search.click(function(){});manifest.request.onerror=log.danger("danger:xhrError");manifest.request.ontimeout=log.danger("danger:xhrTimeout");log.info("info:welcome")()})(this);